<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Báo cáo cuối ca - Tra cứu USER</title>
  <!-- Nhúng thư viện Tabletop.js từ CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .report { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
    h1, h2 { color: #333; }
  </style>
</head>
<body>
  <h1>Báo cáo cuối ca</h1>
  <form id="userForm">
    <label for="username">Nhập USER:</label>
    <input type="text" id="username" name="username" required>
    <button type="submit">Tra cứu</button>
  </form>

  <div id="result" class="report"></div>

  <script>
    // URL của Google Sheet đã được chia sẻ công khai
    const publicSpreadsheetUrl = 'https://docs.google.com/spreadsheets/d/1X3BTYhRypChOLl2BLNTHvcjnoCJ5Ep0HMsHhEXhaIeA/edit?usp=sharing';

    // Hàm hiển thị thông tin khi dữ liệu được tải về
    function showInfo(data, userInput) {
      const resultDiv = document.getElementById('result');

      // Tìm dòng có giá trị của cột USER phù hợp
      const userData = data.find(item => {
        // Nếu cột có tiêu đề là USER thì item.USER có giá trị,
        // nếu không, lấy giá trị của cột thứ 4 (index 3) từ Object.values(item)
        const userColumn = item.USER || Object.values(item)[3];
        return userColumn && userColumn.toLowerCase() === userInput.toLowerCase();
      });
      
      if (userData) {
        let output = '<h2>Thông tin của ' + (item.USER || Object.values(userData)[3]) + '</h2><ul>';
        for (const key in userData) {
          if (userData.hasOwnProperty(key)) {
            output += '<li><strong>' + key + ':</strong> ' + userData[key] + '</li>';
          }
        }
        output += '</ul>';
        resultDiv.innerHTML = output;
      } else {
        resultDiv.innerHTML = '<p>Không tìm thấy dữ liệu cho USER "' + userInput + '"</p>';
      }
    }

    // Xử lý sự kiện submit của form
    document.getElementById('userForm').addEventListener('submit', function(event) {
      event.preventDefault();
      const userInput = document.getElementById('username').value.trim();
      if (!userInput) return;

      Tabletop.init({
        key: publicSpreadsheetUrl,
        simpleSheet: true,
        callback: function(data) {
          showInfo(data, userInput);
        }
      });
    });
  </script>
</body>
</html>
