<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tra cứu USER</title>
    <script>
        async function searchUser() {
            let user = document.getElementById("userInput").value;
            let date = document.getElementById("dateInput").value;
            if (!user || !date) {
                alert("Vui lòng nhập USER và Ngày!");
                return;
            }

            let apiUrl = "https://script.google.com/macros/s/AKfycbyml_gfvkghBk8K3cwid7tg0f6MlPh6QwKX9fUMxcdXwUZaIbQxW3saatsjwOx97EREdw/exec?user=" + encodeURIComponent(user);

            try {
                let response = await fetch(apiUrl);
                let data = await response.json();
                
                let resultDiv = document.getElementById("result");
                resultDiv.innerHTML = ""; 

                if (!data || data.length === 0) {
                    resultDiv.innerHTML = "<p>Không tìm thấy dữ liệu.</p>";
                } else {
                    let filteredData = data.filter(row => row[0].startsWith(date) && String(row[3]).trim() === user);
                    
                    if (filteredData.length === 0) {
                        resultDiv.innerHTML = "<p>Không tìm thấy dữ liệu phù hợp.</p>";
                        return;
                    }

                    let lastResult = filteredData[filteredData.length - 1];

                    let table = "<table border='1'><tr>";
                    for (let header of ["Date", "SIÊU THỊ", "NHÂN VIÊN", "USER", "Cột E", "Cột F", "Cột G", "Cột H", "Cột I", "Cột J", "Cột K", "Cột L"]) {
                        table += `<th>${header}</th>`;
                    }
                    table += "</tr><tr>";
                    
                    for (let cell of lastResult) {
                        table += `<td>${cell}</td>`;
                    }
                    
                    table += "</tr></table>";
                    resultDiv.innerHTML = table;
                }
            } catch (error) {
                console.error("Lỗi:", error);
                document.getElementById("result").innerHTML = "<p>Lỗi khi lấy dữ liệu!</p>";
            }
        }
    </script>
</head>
<body>
    <h2>Tra cứu USER</h2>
    <input type="date" id="dateInput">
    <input type="text" id="userInput" placeholder="Nhập USER">
    <button onclick="searchUser()">Tìm kiếm</button>
    <div id="result"></div>
</body>
</html>
